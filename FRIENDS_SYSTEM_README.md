# 精靈公車 - 好友系統使用說明

## 📋 功能概述

好友系統現已完整實現，包含以下核心功能：

### 🎯 主要功能
1. **邀請碼系統** - 每個用戶都有唯一的邀請碼（基於 player_id）
2. **好友申請** - 通過邀請碼發送好友申請
3. **申請管理** - 查看、接受或拒絕好友申請
4. **好友列表** - 顯示所有好友及其線上狀態
5. **好友移除** - 移除不需要的好友關係

---

## 🏗️ 技術架構

### 資料庫結構 (Firebase Firestore)
```json
{
  "users": {
    "[player_id]": {
      "username": "用戶名稱",
      "player_id": "唯一邀請碼",
      "friends": ["friend_player_id_1", "friend_player_id_2"],
      "friends_pending": ["pending_player_id_1", "pending_player_id_2"]
    }
  }
}
```

### 路由結構
- `GET /community/friends` - 好友頁面
- `POST /community/add-friend` - 發送好友申請
- `POST /community/accept-request/<request_id>` - 接受好友申請
- `POST /community/decline-request/<request_id>` - 拒絕好友申請
- `POST /community/remove-friend/<friend_id>` - 移除好友

---

## 🚀 使用流程

### 1. 邀請好友
1. 用戶A在好友頁面查看自己的邀請碼
2. 用戶A將邀請碼分享給用戶B
3. 用戶B在「新增好友」欄位輸入用戶A的邀請碼
4. 系統將用戶B的ID加入用戶A的 `friends_pending` 列表

### 2. 處理好友申請
1. 用戶A在「好友申請」區域看到用戶B的申請
2. 用戶A可以選擇「接受」或「拒絕」
3. 如果接受：雙方的ID都會加入對方的 `friends` 列表
4. 如果拒絕：申請從 `friends_pending` 中移除

### 3. 管理好友
1. 在「我的好友」區域查看所有好友
2. 可以看到好友的用戶名和邀請碼
3. 可以移除不需要的好友關係

---

## 🎨 前端特性

### JavaScript 功能
- **邀請碼複製** - 一鍵複製邀請碼到剪貼簿
- **表單驗證** - 防止輸入自己的邀請碼
- **用戶體驗** - 複製成功的視覺反饋

### 響應式設計
- Bootstrap 4 卡片佈局
- 行動裝置友善的介面
- 清晰的操作按鈕

---

## 🔧 後端實現

### Firebase 整合
- 使用 Firestore 進行資料存儲
- 即時資料同步
- 交易式操作確保資料一致性

### 錯誤處理
- 完整的例外處理機制
- 用戶友善的錯誤訊息
- 自動重定向到適當頁面

### 安全性
- Flask-Login 身份驗證
- 防止自己加自己好友
- 重複申請檢查

---

## 📝 開發備註

### 已實現的功能
✅ 邀請碼顯示與複製  
✅ 好友申請系統  
✅ 申請列表管理  
✅ 雙向好友關係  
✅ 好友移除功能  
✅ Firebase 資料庫串接  
✅ 前端 JavaScript 互動  
✅ 錯誤處理與驗證  

### 可擴展功能
🔄 線上狀態檢測  
🔄 好友聊天功能  
🔄 好友群組  
🔄 好友推薦  

---

## 🎉 系統現已可用！

好友系統已完成開發並通過測試，用戶可以立即開始使用所有功能。
