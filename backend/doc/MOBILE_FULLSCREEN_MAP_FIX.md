# è¡Œå‹•è£ç½®å…¨è¢å¹•åœ°åœ–ä¿®å¾©èªªæ˜

## å•é¡Œæè¿°

ç”¨æˆ¶åæ˜ åœ¨è¡Œå‹•è£ç½®ä¸­ï¼Œå…¨è¢å¹•åœ°åœ–åªé¡¯ç¤ºä¸€åŠï¼Œç„¡æ³•å®Œæ•´å¡«æ»¿è¢å¹•ã€‚

## å•é¡ŒåŸå› åˆ†æ

1. **Viewporté«˜åº¦è¨ˆç®—å•é¡Œ**: ç§»å‹•ç€è¦½å™¨çš„åœ°å€æ¬„æœƒå½±éŸ¿ `100vh` çš„å¯¦éš›è¨ˆç®—
2. **å®¹å™¨å°ºå¯¸è¨­ç½®ä¸ç•¶**: åŸæœ¬çš„CSSæ²’æœ‰æ­£ç¢ºè™•ç†ç§»å‹•è¨­å‚™çš„ç‰¹æ®Šæƒ…æ³
3. **åœ°åœ–åˆå§‹åŒ–æ™‚æ©Ÿ**: å®¹å™¨å°ºå¯¸å¯èƒ½åœ¨åœ°åœ–å‰µå»ºæ™‚é‚„æœªæ­£ç¢ºè¨­ç½®

## è§£æ±ºæ–¹æ¡ˆ

### 1. CSSå„ªåŒ– âœ…

**ä¿®æ”¹å…§å®¹**: æ›´æ–° `map.html` ä¸­çš„CSSæ¨£å¼

**ä¸»è¦æ”¹é€²**:
```css
/* ç§»å‹•è¨­å‚™å°ˆç”¨é«˜åº¦è¨ˆç®— */
#map {
  height: calc(var(--vh, 1vh) * 100);
  min-height: calc(var(--vh, 1vh) * 100);
}

/* å®‰å…¨å€åŸŸæ”¯æ´ï¼ˆé‡å°æœ‰ç€æµ·çš„è¨­å‚™ï¼‰*/
@media (max-width: 428px) {
  #map {
    padding-top: env(safe-area-inset-top, 0);
    padding-bottom: env(safe-area-inset-bottom, 0);
  }
}
```

### 2. JavaScriptå‹•æ…‹é«˜åº¦è¨ˆç®— âœ…

**æ–°å¢åŠŸèƒ½**: å‹•æ…‹è¨ˆç®—ä¸¦è¨­ç½®æ­£ç¢ºçš„viewporté«˜åº¦

```javascript
function setMobileViewportHeight() {
  const vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
}
```

**åŸ·è¡Œæ™‚æ©Ÿ**:
- é é¢è¼‰å…¥æ™‚
- è¦–çª—å¤§å°æ”¹è®Šæ™‚
- è¨­å‚™æ–¹å‘æ”¹è®Šæ™‚

### 3. åœ°åœ–å®¹å™¨å¼·åŒ– âœ…

**ä¿®æ”¹ä½ç½®**: `fullscreen-map-main-fixed.js`

**æ–°å¢é‚è¼¯**:
- ç§»å‹•è¨­å‚™æª¢æ¸¬
- å¼·åˆ¶å®¹å™¨å°ºå¯¸è¨­ç½®
- åœ°åœ–å°ºå¯¸é‡æ–°è¨ˆç®—

### 4. è§¸æ§å„ªåŒ– âœ…

**æ–°å¢åŠŸèƒ½**:
- ç¦ç”¨é›™æ“Šç¸®æ”¾ï¼ˆé˜²æ­¢æ„å¤–ç¸®æ”¾ï¼‰
- ç¦ç”¨é•·æŒ‰é¸æ“‡
- é˜²æ­¢æ»¾å‹•å½ˆè·³

## æŠ€è¡“å¯¦ç¾ç´°ç¯€

### CSSè®Šæ•¸ä½¿ç”¨
```css
:root {
  --vh: 1vh;
}

#map {
  height: calc(var(--vh, 1vh) * 100);
}
```

### JavaScripté«˜åº¦è¨ˆç®—
```javascript
// å¯¦éš›viewporté«˜åº¦ = è¦–çª—å…§é«˜ Ã— 1%
const vh = window.innerHeight * 0.01;
document.documentElement.style.setProperty('--vh', `${vh}px`);
```

### ç§»å‹•è¨­å‚™æª¢æ¸¬
```javascript
const isMobile = window.innerWidth <= 768;
if (isMobile) {
  // ç§»å‹•è¨­å‚™å°ˆç”¨è™•ç†
}
```

## æ”¯æ´çš„è¨­å‚™

### ğŸ“± æ‰‹æ©Ÿè¨­å‚™
- **iPhone**: æ‰€æœ‰å°ºå¯¸ï¼ˆåŒ…æ‹¬æœ‰ç€æµ·çš„æ©Ÿå‹ï¼‰
- **Android**: å„ç¨®è¢å¹•æ¯”ä¾‹
- **æ–¹å‘**: ç›´å‘å’Œæ©«å‘æ¨¡å¼

### ğŸ“Ÿ å¹³æ¿è¨­å‚™
- **iPad**: å„ç¨®å°ºå¯¸
- **Androidå¹³æ¿**: 7-12å‹è¢å¹•

### ç‰¹æ®Šæƒ…æ³è™•ç†
- **ç€æµ·å±å¹•**: ä½¿ç”¨ `env(safe-area-inset-*)` è™•ç†
- **å¯æŠ˜ç–Šè¨­å‚™**: å‹•æ…‹éŸ¿æ‡‰è¢å¹•è®ŠåŒ–
- **åˆ†å±æ¨¡å¼**: æ­£ç¢ºè¨ˆç®—å¯ç”¨ç©ºé–“

## æ¸¬è©¦é©—è­‰

### è‡ªå‹•æ¸¬è©¦
ç³»çµ±å·²å…§å»ºæ¸¬è©¦è…³æœ¬ï¼Œæœƒåœ¨é é¢è¼‰å…¥å¾Œè‡ªå‹•åŸ·è¡Œï¼š

```javascript
// æª¢æŸ¥å…¨è¢å¹•é¡¯ç¤ºç‹€æ…‹
window.fullscreenMapTest.runFullscreenMapTest();

// ä¿®å¾©å¸¸è¦‹å•é¡Œ
window.fullscreenMapTest.fixCommonIssues();
```

### æ‰‹å‹•æ¸¬è©¦
åœ¨ç€è¦½å™¨æ§åˆ¶å°åŸ·è¡Œï¼š
```javascript
// å®Œæ•´æ¸¬è©¦
window.fullscreenMapTest.runFullscreenMapTest();

// æª¢æŸ¥è¨­å‚™ä¿¡æ¯
window.fullscreenMapTest.detectDevice();

// æª¢æŸ¥å®¹å™¨å°ºå¯¸
window.fullscreenMapTest.checkMapContainerSize();
```

## ä¿®å¾©æ•ˆæœ

### ä¿®å¾©å‰ âŒ
```
ç§»å‹•è¨­å‚™é¡¯ç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     åœ°åœ–å€åŸŸ     â”‚ â† åªä½”è¢å¹•ä¸€åŠ
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ç©ºç™½å€åŸŸ     â”‚ â† æµªè²»çš„ç©ºé–“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¿®å¾©å¾Œ âœ…
```
ç§»å‹•è¨­å‚™é¡¯ç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 â”‚
â”‚                 â”‚
â”‚    å®Œæ•´åœ°åœ–     â”‚ â† å¡«æ»¿æ•´å€‹è¢å¹•
â”‚                 â”‚
â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ•ˆèƒ½å„ªåŒ–

### 1. äº‹ä»¶ç¯€æµ
```javascript
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(setMobileViewportHeight, 100);
});
```

### 2. æ¢ä»¶åŸ·è¡Œ
```javascript
const isMobile = window.innerWidth <= 768;
if (isMobile) {
  // åªåœ¨ç§»å‹•è¨­å‚™åŸ·è¡Œç‰¹æ®Šè™•ç†
}
```

### 3. è¨˜æ†¶é«”ç®¡ç†
- é©ç•¶çš„äº‹ä»¶ç›£è½å™¨æ¸…ç†
- é¿å…è¨˜æ†¶é«”æ´©æ¼

## ç›¸å®¹æ€§

### ç€è¦½å™¨æ”¯æ´
- âœ… Safari (iOS 12+)
- âœ… Chrome Mobile (Android 8+)
- âœ… Firefox Mobile
- âœ… Samsung Internet
- âœ… Edge Mobile

### CSSåŠŸèƒ½æ”¯æ´
- âœ… CSS Variables (`--vh`)
- âœ… Calc() function
- âœ… Safe area insets
- âœ… Media queries

## æ•…éšœæ’é™¤

### Q: æŸäº›è¨­å‚™ä»é¡¯ç¤ºä¸å®Œæ•´ï¼Ÿ
**A**: åŸ·è¡Œ `window.fullscreenMapTest.fixCommonIssues()` å˜—è©¦ä¿®å¾©

### Q: æ–¹å‘æ”¹è®Šå¾Œåœ°åœ–é¡¯ç¤ºç•°å¸¸ï¼Ÿ
**A**: ç³»çµ±æœƒè‡ªå‹•é‡æ–°è¨ˆç®—ï¼Œç­‰å¾…1-2ç§’å³å¯

### Q: åœ°åœ–ç„¡æ³•è§¸æ§æ“ä½œï¼Ÿ
**A**: æª¢æŸ¥åœ°åœ–åˆå§‹åŒ–æ˜¯å¦å®Œæˆï¼Œå¯é‡æ–°æ•´ç†é é¢

## æª”æ¡ˆæ¸…å–®

### ä¿®æ”¹çš„æª”æ¡ˆ
- âœ… `app/templates/game/map.html` - CSSå’ŒHTMLå„ªåŒ–
- âœ… `app/static/js/game/fullscreen-map-main-fixed.js` - åœ°åœ–åˆå§‹åŒ–å„ªåŒ–

### æ–°å¢çš„æª”æ¡ˆ
- âœ… `app/static/js/test/mobile-fullscreen-test.js` - æ¸¬è©¦é©—è­‰è…³æœ¬

## ç¶­è­·å»ºè­°

1. **å®šæœŸæ¸¬è©¦**: åœ¨å„ç¨®ç§»å‹•è¨­å‚™ä¸Šæ¸¬è©¦åœ°åœ–é¡¯ç¤º
2. **ç›£æ§å›é¥‹**: æ”¶é›†ç”¨æˆ¶é—œæ–¼é¡¯ç¤ºå•é¡Œçš„å›é¥‹
3. **ç€è¦½å™¨æ›´æ–°**: é—œæ³¨ç€è¦½å™¨å°viewportçš„è™•ç†è®ŠåŒ–
4. **æ–°è¨­å‚™æ”¯æ´**: æ¸¬è©¦æ–°ç™¼å¸ƒçš„ç§»å‹•è¨­å‚™ç›¸å®¹æ€§

---

**ç‹€æ…‹**: âœ… å·²å®Œæˆ  
**æ•ˆæœ**: ğŸ¯ ç§»å‹•è¨­å‚™å…¨è¢å¹•é¡¯ç¤ºå·²å„ªåŒ–  
**æ¸¬è©¦**: ğŸ§ª è‡ªå‹•æ¸¬è©¦è…³æœ¬å·²éƒ¨ç½²  
**ç›¸å®¹æ€§**: ğŸ“± æ”¯æ´ä¸»æµç§»å‹•è¨­å‚™

*æœ€å¾Œæ›´æ–°: 2025å¹´6æœˆ18æ—¥*
