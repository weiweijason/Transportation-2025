<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>測試用戶精靈API</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .creature-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .creature-card img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .loading { background-color: #d1ecf1; color: #0c5460; }
        .debug {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>測試用戶精靈API</h1>
    
    <button onclick="testAPI()">測試 /game/api/user/creatures</button>
    <button onclick="clearResults()">清除結果</button>
    
    <div id="status"></div>
    <div id="debug"></div>
    <div id="results"></div>

    <script>
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
        }

        function showDebug(data) {
            const debugDiv = document.getElementById('debug');
            debugDiv.textContent = JSON.stringify(data, null, 2);
        }

        function clearResults() {
            document.getElementById('status').innerHTML = '';
            document.getElementById('debug').innerHTML = '';
            document.getElementById('results').innerHTML = '';
        }

        function testAPI() {
            showStatus('正在測試API...', 'loading');
            clearResults();
            
            fetch('/game/api/user/creatures')
                .then(response => {
                    console.log('Response status:', response.status);
                    console.log('Response headers:', response.headers);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('API 響應數據:', data);
                    showDebug(data);
                    
                    if (data.error) {
                        showStatus(`API 錯誤: ${data.error}`, 'error');
                        return;
                    }
                    
                    if (Array.isArray(data)) {
                        if (data.length > 0) {
                            showStatus(`成功獲取 ${data.length} 隻精靈`, 'success');
                            displayCreatures(data);
                        } else {
                            showStatus('用戶沒有精靈', 'success');
                        }
                    } else {
                        showStatus('API 返回的數據格式不正確', 'error');
                    }
                })
                .catch(error => {
                    console.error('API 調用失敗:', error);
                    showStatus(`API 調用失敗: ${error.message}`, 'error');
                });
        }

        function displayCreatures(creatures) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h2>精靈列表：</h2>';
            
            creatures.forEach((creature, index) => {
                const creatureDiv = document.createElement('div');
                creatureDiv.className = 'creature-card';
                creatureDiv.innerHTML = `
                    <img src="${creature.image_url || '/static/img/creature.png'}" 
                         alt="${creature.name}" 
                         onerror="this.src='/static/img/creature.png'">
                    <div>
                        <h3>${creature.name || '未知精靈'}</h3>
                        <p><strong>元素:</strong> ${creature.element || 'Normal'}</p>
                        <p><strong>ATK:</strong> ${creature.attack || creature.power || 100} | <strong>HP:</strong> ${creature.hp || (creature.power || 100) * 10}</p>
                        <p><strong>等級:</strong> ${creature.level || 1}</p>
                        <p><strong>ID:</strong> ${creature.id}</p>
                    </div>
                `;
                resultsDiv.appendChild(creatureDiv);
            });
        }

        // 頁面載入時自動測試
        window.addEventListener('load', function() {
            setTimeout(testAPI, 1000);
        });
    </script>
</body>
</html>
