#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Leaflet åœ°åœ–å®¹å™¨é‡è¤‡ä½¿ç”¨éŒ¯èª¤ä¿®å¾©å ±å‘Š - ç¬¬äºŒç‰ˆ
"""

print("ğŸ”§ Leaflet åœ°åœ–å®¹å™¨é‡è¤‡ä½¿ç”¨éŒ¯èª¤ä¿®å¾©å ±å‘Š - ç¬¬äºŒç‰ˆ")
print("=" * 70)

print("\nâŒ æ–°ç™¼ç¾çš„éŒ¯èª¤:")
print("1. safeSetMapView ç™¼ç”ŸéŒ¯èª¤: TypeError: Cannot read properties of undefined (reading '_leaflet_pos')")
print("2. å‰µå»ºå…¨è¢å¹•åœ°åœ–å¤±æ•—: Error: Map container is being reused by another instance")

print("\nğŸ” æ·±åº¦å•é¡Œåˆ†æ:")
print("1. _leaflet_pos éŒ¯èª¤æŒçºŒç™¼ç”Ÿ:")
print("   - å³ä½¿åœ¨å®‰å…¨æª¢æŸ¥å¾Œï¼ŒsetView å…§éƒ¨ä»è§¸ç™¼ç›¸åŒéŒ¯èª¤")
print("   - è¡¨ç¤ºåœ°åœ–çš„å…§éƒ¨ç‹€æ…‹å­˜åœ¨ä¸ä¸€è‡´")
print("   - åœ°åœ–çš„ DOM çµæ§‹å¯èƒ½å·²æå£")

print("\n2. å®¹å™¨é‡è¤‡ä½¿ç”¨éŒ¯èª¤:")
print("   - åœ°åœ–å®¹å™¨æ²’æœ‰è¢«æ­£ç¢ºæ¸…ç†")
print("   - Leaflet å…§éƒ¨ä»èªç‚ºå®¹å™¨è¢«å¦ä¸€å€‹å¯¦ä¾‹ä½¿ç”¨")
print("   - éœ€è¦æ›´å¾¹åº•çš„å®¹å™¨é‡ç½®")

print("\nâœ… ç¬¬äºŒç‰ˆåŠ å¼·ä¿®å¾©:")

print("\n1. ğŸ“ map-functions.js - å¢å¼· safeSetMapView:")
print("   - æ·»åŠ åœ°åœ–å…§éƒ¨çµæ§‹æª¢æŸ¥ (_panes, mapPane)")
print("   - å¼·åˆ¶é‡æ–°è¨ˆç®—å®¹å™¨ä½ç½® (invalidateSize)")
print("   - å¯¦æ–½åˆ†æ­¥è¨­ç½®ç­–ç•¥: panTo + setZoom")
print("   - æ›´è©³ç´°çš„éŒ¯èª¤æ—¥èªŒå’Œå‚™ç”¨æ–¹æ¡ˆ")

print("\n2. ğŸ“ map-functions.js - å¾¹åº•å®¹å™¨æ¸…ç†:")
print("   - æ–°å¢ thoroughlyCleanContainer() å‡½æ•¸")
print("   - ç§»é™¤æ‰€æœ‰ Leaflet æ•¸æ“šå±¬æ€§ (_leaflet_id, _leaflet)")
print("   - æ¸…é™¤ Leaflet CSS é¡åˆ¥")
print("   - å®Œå…¨é‡ç½®å®¹å™¨æ¨£å¼å’Œå…§å®¹")
print("   - å»¶é²å‰µå»ºç¢ºä¿æ¸…ç†å®Œæˆ")

print("\n3. ğŸ“ map-functions.js - å®‰å…¨å¯¦ä¾‹ç§»é™¤:")
print("   - ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›£è½å™¨ (map.off())")
print("   - æ‰‹å‹•æ¸…ç†å¤±æ•—å¯¦ä¾‹çš„å®¹å™¨")
print("   - åˆ†é›¢ createNewMapInstance ç‚ºç¨ç«‹å‡½æ•¸")

print("\n4. ğŸ“ map.html - æ™ºèƒ½éŒ¯èª¤æ¢å¾©:")
print("   - æª¢æ¸¬å®¹å™¨é‡è¤‡ä½¿ç”¨éŒ¯èª¤")
print("   - è‡ªå‹•è§¸ç™¼å¼·åŠ›é‡å»ºæµç¨‹")
print("   - é‡æ•´åœ°åœ–æŒ‰éˆ•ä½¿ç”¨æ–°çš„æ¸…ç†æ–¹æ³•")

print("\nğŸ›¡ï¸ æ–°å¢å®‰å…¨æªæ–½:")
print("1. åˆ†å±¤æ¸…ç†ç­–ç•¥:")
print("   - ç¬¬ä¸€å±¤: æ¨™æº– map.remove()")
print("   - ç¬¬äºŒå±¤: æ‰‹å‹•å®¹å™¨æ¸…ç†")
print("   - ç¬¬ä¸‰å±¤: DOM å…ƒç´ å®Œå…¨é‡ç½®")

print("\n2. åˆ†æ­¥åœ°åœ–æ“ä½œ:")
print("   - å¦‚æœ setView å¤±æ•—ï¼Œä½¿ç”¨ panTo + setZoom")
print("   - é¿å…ä¸€æ¬¡æ€§æ“ä½œè§¸ç™¼å…§éƒ¨éŒ¯èª¤")

print("\n3. æ™ºèƒ½éŒ¯èª¤æª¢æ¸¬:")
print("   - æª¢æ¸¬ç‰¹å®šéŒ¯èª¤é¡å‹")
print("   - é‡å°ä¸åŒéŒ¯èª¤ä½¿ç”¨ä¸åŒæ¢å¾©ç­–ç•¥")

print("\nğŸ§ª å»ºè­°æ¸¬è©¦æµç¨‹:")
print("1. æ¸…é™¤ç€è¦½å™¨ç·©å­˜å’Œæœ¬åœ°å­˜å„²")
print("2. é–‹å•Ÿé–‹ç™¼è€…å·¥å…·ç›£æ§æ§åˆ¶å°")
print("3. æ¸¬è©¦åºåˆ—:")
print("   a) è¼‰å…¥å…¨è¢å¹•åœ°åœ–é é¢")
print("   b) é»æ“Šã€Œç›®å‰ä½ç½®ã€æŒ‰éˆ• 3-5 æ¬¡")
print("   c) é»æ“Šã€Œé‡æ•´åœ°åœ–ã€æŒ‰éˆ•")
print("   d) å¿«é€Ÿåˆ‡æ›åˆ°å…¶ä»–é é¢å†å›ä¾†")
print("   e) èª¿æ•´ç€è¦½å™¨è¦–çª—å¤§å°")

print("\nğŸ“Š éŒ¯èª¤ç›£æ§è¦é»:")
print("- è§€å¯Ÿæ˜¯å¦é‚„æœ‰ '_leaflet_pos' éŒ¯èª¤")
print("- æª¢æŸ¥æ˜¯å¦é‚„æœ‰ 'container is being reused' éŒ¯èª¤")
print("- æ³¨æ„æ–°çš„éŒ¯èª¤é¡å‹å’Œæ¢å¾©æ©Ÿåˆ¶çš„æ•ˆæœ")
print("- ç¢ºèªåœ°åœ–åŠŸèƒ½æ˜¯å¦æ­£å¸¸ (ç¸®æ”¾ã€æ‹–å‹•ã€æ¨™è¨˜)")

print("\nğŸ¯ é æœŸæ”¹å–„:")
print("- âœ… å¾¹åº•è§£æ±ºå®¹å™¨é‡è¤‡ä½¿ç”¨å•é¡Œ")
print("- âœ… å¤§å¹…æ¸›å°‘ _leaflet_pos éŒ¯èª¤")
print("- âœ… æ›´å¼·å¥çš„è‡ªå‹•æ¢å¾©æ©Ÿåˆ¶")
print("- âœ… æ›´è©³ç´°çš„éŒ¯èª¤è¨ºæ–·ä¿¡æ¯")

print("\nâš ï¸ å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨:")
print("1. æª¢æŸ¥æ§åˆ¶å°ä¸­çš„è©³ç´°éŒ¯èª¤æ—¥èªŒ")
print("2. ç¢ºèªæ–°çš„å®‰å…¨å‡½æ•¸æ˜¯å¦è¢«æ­£ç¢ºèª¿ç”¨")
print("3. å˜—è©¦å®Œå…¨åˆ·æ–°é é¢è€Œéä½¿ç”¨é‡æ•´æŒ‰éˆ•")
print("4. è€ƒæ…®ç€è¦½å™¨å…¼å®¹æ€§å•é¡Œ")

print("\nâœ¨ ç¬¬äºŒç‰ˆä¿®å¾©å®Œæˆï¼")
print("ç¾åœ¨æ‡‰è©²èƒ½è™•ç†æ›´è¤‡é›œçš„åœ°åœ–å¯¦ä¾‹è¡çªå’Œå®¹å™¨é‡è¤‡ä½¿ç”¨å•é¡Œã€‚")
